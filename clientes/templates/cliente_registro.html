{% extends 'base.html' %}

{% block title %}
Registrar Cliente
{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="card shadow-lg">
        <div class="card-header bg-primary text-white text-center">
            <h2><i class="fas fa-user-plus"></i> Cadastro de Cliente</h2>
        </div>
        <div class="card-body">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                        <i class="fas fa-info-circle"></i> {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endfor %}
            {% endif %}
        
            {% if form.errors %}
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <i class="fas fa-exclamation-circle"></i> <strong>Erro ao salvar:</strong> Por favor, corrija os erros abaixo.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    <ul>
                        {% for field, errors in form.errors.items %}
                            <li><strong>{{ field|title }}</strong>: {{ errors.0 }}</li>
                        {% endfor %}
                    </ul>
                </div>
            {% endif %}
        </div>

            <form method="post" novalidate class="row g-3">
                {% csrf_token %}

                <div class="col-md-4">
                    <label for="id_name" class="form-label"><i class="fas fa-user"></i> Nome Completo</label>
                    {{ form.name }}
                    {% if form.name.errors %}
                        <div class="text-danger">
                            {{ form.name.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-2">
                    <label for="id_d_nasc" class="form-label"><i class="fas fa-calendar-alt"></i> Data Nasc.</label>
                    {{ form.d_nasc }}
                    {% if form.d_nasc.errors %}
                        <div class="text-danger">
                            {{ form.d_nasc.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-3">
                    <label for="id_cpf" class="form-label"><i class="fas fa-id-card"></i> CPF</label>
                    {{ form.cpf }}
                    {% if form.cpf.errors %}
                        <div class="text-danger">
                            {{ form.cpf.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-3">
                    <label for="id_rg" class="form-label"><i class="fas fa-id-badge"></i> RG</label>
                    {{ form.rg }}
                    {% if form.rg.errors %}
                        <div class="text-danger">
                            {{ form.rg.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-3">
                    <label for="id_telefone" class="form-label"><i class="fas fa-phone"></i> Telefone</label>
                    {{ form.telefone }}
                    {% if form.telefone.errors %}
                        <div class="text-danger">
                            {{ form.telefone.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-3">
                    <label for="id_telefone2" class="form-label"><i class="fas fa-phone-alt"></i> Telefone 2</label>
                    {{ form.telefone2 }}
                    {% if form.telefone2.errors %}
                        <div class="text-danger">
                            {{ form.telefone2.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-6">
                    <label for="id_email" class="form-label"><i class="fas fa-envelope"></i> E-mail</label>
                    {{ form.email }}
                    {% if form.email.errors %}
                        <div class="text-danger">
                            {{ form.email.errors.0 }}
                        </div>
                    {% endif %}
                </div>

                <div class="col-md-4">
                    <label for="id_sexo" class="form-label"><i class="fas fa-venus-mars"></i> Sexo</label>
                    {{ form.sexo }}
                </div>

                <div class="col-md-4">
                    <label for="id_tipo_cliente" class="form-label"><i class="fas fa-briefcase-medical"></i> Tipo de
                        Cliente</label>
                    {{ form.tipo_cliente }}
                </div>

                <div class="col-md-4">
                    <label for="id_estado_civil" class="form-label"><i class="fas fa-ring"></i> Estado Civil</label>
                    {{ form.estado_civil }}
                </div>

                <div class="col-md-4">
                    <label for="id_formacao" class="form-label"><i class="fas fa-graduation-cap"></i> Formação</label>
                    {{ form.formacao }}
                </div>

                <div class="col-md-6">
                    <label for="id_ocupacao" class="form-label"><i class="fas fa-briefcase"></i> Ocupação/Função</label>
                    {{ form.ocupacao }}
                </div>

                <div class="col-md-4">
                    <label for="id_cep" class="form-label"><i class="fas fa-mail-bulk"></i> CEP</label>
                    <div class="input-group">
                        {{ form.cep }}
                        <button type="button" id="buscar-cep" class="btn btn-primary">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>
                </div>

                <div class="col-md-6">
                    <label for="id_endereco" class="form-label"><i class="fas fa-map-marker-alt"></i> Endereço</label>
                    {{ form.endereco }}
                </div>

                <div class="col-md-2">
                    <label for="id_numero" class="form-label"><i class="fas fa-hashtag"></i> Número</label>
                    {{ form.numero }}
                </div>

                <div class="col-md-4">
                    <label for="id_complemento" class="form-label"><i class="fas fa-building"></i> Complemento</label>
                    {{ form.complemento }}
                </div>

                <div class="col-md-4">
                    <label for="id_bairro" class="form-label"><i class="fas fa-city"></i> Bairro</label>
                    {{ form.bairro }}
                </div>

                <div class="col-md-4">
                    <label for="id_cidade" class="form-label"><i class="fas fa-map"></i> Cidade</label>
                    {{ form.cidade }}
                </div>

                <div class="col-md-4">
                    <label for="id_estado" class="form-label"><i class="fas fa-flag"></i> Estado</label>
                    {{ form.estado }}
                </div>

                <div class="col-md-4">
                    <label for="id_acao" class="form-label"><i class="fas fa-bullhorn"></i> Veio através de</label>
                    {{ form.acao }}
                </div>

                <div class="col-md-4">
                    <label for="id_plano_saude" class="form-label fw-bold">
                        <i class="fas fa-notes-medical me-2"></i> Possui Plano de Saúde?
                    </label>
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="toggleSwitch">
                        <label class="form-check-label" id="toggleLabel" for="toggleSwitch">OFF</label>
                    </div>
                </div>
                
                <div class="col-md-6 mt-3" id="plano-saude-nome" style="display: none;">
                    <label for="id_nome_plano" class="form-label"><i class="fas fa-hospital"></i> Qual Plano?</label>
                    <input type="text" class="form-control" id="id_nome_plano" placeholder="Digite o nome do plano">
                </div>

                <div class="col-md-12">
                    <label for="id_restricao" class="form-label"><i class="fas fa-exclamation-triangle"></i> Restrições</label>
                    {{ form.restricao }}
                </div>

                <div class="d-flex justify-content-end mt-4">
                    <button type="submit" class="btn btn-success me-2"><i class="fas fa-check"></i> Registrar</button>
                    <a href="{% url 'clientes_list' %}" class="btn btn-secondary"><i class="fas fa-times"></i>
                        Cancelar</a>
                </div>

                <style>
                    .form-switch .form-check-input {
                        width: 60px;
                        height: 30px;
                        background-color: red;
                        border: 1px solid #ccc;
                        position: relative;  /* Adicionado para manter dentro do switch */
                        cursor: pointer;
                    }
                
                    .form-switch .form-check-input:checked {
                        background-color: green;
                    }
                
                    .form-switch .form-check-input::before {
                        content: "";
                        position: absolute;
                        width: 26px;
                        height: 26px;
                        border-radius: 50%;
                        background: white;
                        top: 2px;
                        left: 2px;
                        transition: transform 0.3s ease;
                    }
                
                    .form-switch .form-check-input:checked::before {
                        transform: translateX(30px);
                    }
                
                    .form-switch .form-check-label {
                        font-weight: bold;
                        margin-left: 10px;
                    }
                </style>
                
            </form>
        </div>
    </div>
</div>

<script>
    document.getElementById('buscar-cep').addEventListener('click', function () {
        let cep = document.getElementById('id_cep').value.replace(/\D/g, '');
        if (cep.length === 8) {
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        document.getElementById('id_endereco').value = data.logradouro;
                        document.getElementById('id_bairro').value = data.bairro;
                        document.getElementById('id_cidade').value = data.localidade;
                        document.getElementById('id_estado').value = data.uf;
                    } else {
                        alert("CEP não encontrado!");
                    }
                })
                .catch(() => alert("Erro ao consultar o CEP!"));
        } else {
            alert("Digite um CEP válido.");
        }
    });

    document.getElementById('toggleSwitch').addEventListener('change', function () {
        const planoSaudeNome = document.getElementById('plano-saude-nome');
        const label = document.getElementById('toggleLabel');

        if (this.checked) {
            label.textContent = 'ON';
            label.style.color = 'green';
            planoSaudeNome.style.display = 'block';
        } else {
            label.textContent = 'OFF';
            label.style.color = 'red';
            planoSaudeNome.style.display = 'none';
        }
    });
</script>
{% endblock %}